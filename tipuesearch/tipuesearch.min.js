!function(e){e.fn.tipuesearch=function(t){var i=e.extend({contentLocation:"tipuesearch/tipuesearch_content.json",contextBuffer:60,contextLength:60,contextStart:90,debug:!1,descriptiveWords:0,highlightTerms:!0,liveContent:"*",liveDescription:"*",minimumLength:3,mode:"static",newWindow:!1,show:9,showContext:!0,showRelated:!0,showTime:!0,showTitleCount:!0,showURL:!1,wholeWords:!0},t);return this.each(function(){function t(e){var t=location.search,i=(new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(t)||[,""])[1].replace(/\+/g,"%20");try{i=decodeURIComponent(i)}catch(e){i=unescape(i)}return i||null}function a(t,n){var h="",l=!1,o=!1,p=!0,u=0;found=[];var _=e("#tipue_search_input").val(),d=_.toLowerCase();((d=e.trim(d)).match('^"')&&d.match('"$')||d.match("^'")&&d.match("'$"))&&(p=!1);var g=d.split(" ");if(p){d="";for(w=0;w<g.length;w++){for(var f=!0,v=0;v<tipuesearch_stop_words.length;v++)g[w]==tipuesearch_stop_words[v]&&(f=!1,o=!0);f&&(d=d+" "+g[w])}g=(d=e.trim(d)).split(" ")}else d=d.substring(1,d.length-1);if(d.length>=i.minimumLength){if(p){if(n){for(var m=d,w=0;w<g.length;w++)for(v=0;v<tipuesearch_replace.words.length;v++)g[w]==tipuesearch_replace.words[v].word&&(d=d.replace(g[w],tipuesearch_replace.words[v].replace_with),l=!0);g=d.split(" ")}for(var x=d,w=0;w<g.length;w++)for(v=0;v<tipuesearch_stem.words.length;v++)g[w]==tipuesearch_stem.words[v].word&&(x=x+" "+tipuesearch_stem.words[v].stem);g=x.split(" ");for(w=0;w<s.pages.length;w++){for(var T=0,b=s.pages[w].text,v=0;v<g.length;v++){if(i.wholeWords)L=new RegExp("\\b"+g[v]+"\\b","gi");else L=new RegExp(g[v],"gi");if(-1!=s.pages[w].title.search(L)&&(T+=20*(C=s.pages[w].title.match(L).length)),-1!=s.pages[w].text.search(L)&&(T+=20*(C=s.pages[w].text.match(L).length)),-1!=s.pages[w].tags.search(L)&&(T+=10*(C=s.pages[w].tags.match(L).length)),-1!=s.pages[w].url.search(L)&&(T+=20),0!=T)for(R=0;R<tipuesearch_weight.weight.length;R++)s.pages[w].url==tipuesearch_weight.weight[R].url&&(T+=tipuesearch_weight.weight[R].score);g[v].match("^-")&&(L=new RegExp(g[v].substring(1),"i"),-1==s.pages[w].title.search(L)&&-1==s.pages[w].text.search(L)&&-1==s.pages[w].tags.search(L)||(T=0))}0!=T&&(found.push({score:T,title:s.pages[w].title,desc:b,url:s.pages[w].url,mainUrl:s.pages[w].mainUrl,mainTitle:s.pages[w].mainTitle}),u++)}}else for(w=0;w<s.pages.length;w++){var T=0,b=s.pages[w].text,L=new RegExp(d,"gi");if(-1!=s.pages[w].title.search(L)&&(T+=20*(C=s.pages[w].title.match(L).length)),-1!=s.pages[w].text.search(L)&&(T+=20*(C=s.pages[w].text.match(L).length)),-1!=s.pages[w].tags.search(L)){var C=s.pages[w].tags.match(L).length;T+=10*C}if(-1!=s.pages[w].url.search(L)&&(T+=20),0!=T)for(var R=0;R<tipuesearch_weight.weight.length;R++)s.pages[w].url==tipuesearch_weight.weight[R].url&&(T+=tipuesearch_weight.weight[R].score);0!=T&&(found.push({score:T,title:s.pages[w].title,desc:b,url:s.pages[w].url,mainUrl:s.pages[w].mainUrl,mainTitle:s.pages[w].mainTitle}),u++)}if(0!=u){if(i.showTitleCount&&0==r){var U=document.title;document.title="("+u+") "+U,r++}l&&(h+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+d+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+m+"</a></div>"),1==u?h+='<div id="tipue_search_results_count">'+tipuesearch_string_4:(c_c=u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),h+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5),i.showTime&&(h+=" ("+(((new Date).getTime()-startTimer)/1e3).toFixed(2)+" "+tipuesearch_string_14+")",i.showTime=!1),h+="</div>",found.sort(function(e,t){return t.mainTitle.localeCompare(e.mainTitle)});for(var k=[],y=0,w=0;w<found.length;w++){if(console.log(found[w]),y>=t&&y<i.show+t){if(0===k.length?(h+='<hr><div class="tipue_search_content_mainTitle"><a href="'+found[w].mainUrl+'"'+c+">"+found[w].mainTitle+"</a></div>",h+='<div class="tipue_search_content_title"><a href="'+found[w].url+'"'+c+">"+found[w].title+"</a></div>",k.push(found[w].mainTitle)):found[w].mainTitle!=k.slice(-1)?(h+='<hr><div class="tipue_search_content_mainTitle"><a href="'+found[w].mainUrl+'"'+c+">"+found[w].mainTitle+"</a></div>",h+='<div class="tipue_search_content_title"><a href="'+found[w].url+'"'+c+">"+found[w].title+"</a></div>",(k=[]).push(found[w].mainTitle)):found[w].mainTitle==k.slice(-1)&&(h+='<div class="tipue_search_content_title"><a href="'+found[w].url+'"'+c+">"+found[w].title+"</a></div>",(k=[]).push(found[w].mainTitle)),i.debug&&(h+='<div class="tipue_search_content_debug">Score: '+found[w].score+"</div>"),i.showURL){var E=found[w].url.toLowerCase();0==E.indexOf("http://")&&(E=E.slice(7)),h+='<div class="tipue_search_content_url"><a href="'+found[w].url+'"'+c+">"+E+"</a></div>"}if(found[w].desc){var W=found[w].desc;if(i.showContext){g=d.split(" ");var O=found[w].desc.toLowerCase().indexOf(g[0]);if(O>i.contextStart){var S=W.substr(O-i.contextBuffer),$=S.indexOf(" ");S=W.substr(O-i.contextBuffer+$),(S=e.trim(S)).length>i.contextLength&&(W="... "+S)}}if(p){g=d.split(" ");for(v=0;v<g.length;v++)if(i.highlightTerms){j=new RegExp("("+g[v]+")","gi");W=W.replace(j,"<h0011>$1<h0012>")}}else if(i.highlightTerms){var j=new RegExp("("+d+")","gi");W=W.replace(j,'<span class="tipue_search_content_bold">$1</span>')}var B="",D=W.split(" ");if(D.length<i.descriptiveWords)B=W;else for(v=0;v<i.descriptiveWords;v++)B+=D[v]+" ";"."!=(B=e.trim(B)).charAt(B.length-1)&&(B+=""),h+='<div class="tipue_search_content_text">'+(B=(B=B.replace(/h0011/g,'span class="tipue_search_content_bold"')).replace(/h0012/g,"/span"))+"</div>"}}y++}if(i.showRelated&&p){v=0;for(w=0;w<tipuesearch_related.searches.length;w++)d==tipuesearch_related.searches[w].search&&(l&&(_=d),v||(h+='<div class="tipue_search_related_title">'+tipuesearch_string_15+' <span class="tipue_search_related_bold">'+_+'</span></div><div class="tipue_search_related_cols">'),h+='<div class="tipue_search_related_text"><a class="tipue_search_related" id="'+tipuesearch_related.searches[w].related+'">',tipuesearch_related.searches[w].before&&(h+='<span class="tipue_search_related_before">'+tipuesearch_related.searches[w].before+"</span> "),h+=tipuesearch_related.searches[w].related,tipuesearch_related.searches[w].after&&(h+=' <span class="tipue_search_related_after">'+tipuesearch_related.searches[w].after+"</span>"),h+="</a></div>",v++);v&&(h+="</div>")}if(u>i.show){var q=Math.ceil(u/i.show),I=t/i.show;if(h+='<nav><div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',t>0&&(h+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="b" id="'+(t-i.show)+"_"+n+'">'+tipuesearch_string_6+"</a></li>"),I<=2){var A=q;q>3&&(A=3);for(v=0;v<A;v++)h+=v==I?'<li class="current" role="navigation">'+(v+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+v*i.show+"_"+n+'">'+(v+1)+"</a></li>"}else{(A=I+2)>q&&(A=q);for(v=I-1;v<A;v++)h+=v==I?'<li class="current" role="navigation">'+(v+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+v*i.show+"_"+n+'">'+(v+1)+"</a></li>"}I+1!=q&&(h+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="m" id="'+(t+i.show)+"_"+n+'">'+tipuesearch_string_7+"</a></li>"),h+="</ul></div></nav>"}}else h+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else o?h+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(h+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",1==i.minimumLength?h+='<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>":h+='<div id="tipue_search_warning">'+tipuesearch_string_12+" "+i.minimumLength+" "+tipuesearch_string_13+"</div>");e("#tipue_search_content").hide().html(h).slideDown(200),e("#tipue_search_replaced").click(function(){a(0,!1)}),e(".tipue_search_related").click(function(){e("#tipue_search_input").val(e(this).attr("id")),a(0,!0)}),e(".tipue_search_foot_box").click(function(){var t=e(this).attr("id").split("_");a(parseInt(t[0]),t[1])})}var s={pages:[]};e.ajaxSetup({async:!1});var r=0;if(e("#tipue_search_content").hide().html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>').show(),"live"==i.mode)for(var n=0;n<tipuesearch_pages.length;n++)e.get(tipuesearch_pages[n]).done(function(t){var a=e(i.liveContent,t).text();a=a.replace(/\s+/g," ");var r=e(i.liveDescription,t).text();r=r.replace(/\s+/g," ");var c=t.toLowerCase().indexOf("<title>"),h=t.toLowerCase().indexOf("</title>",c+7);if(-1!=c&&-1!=h)l=t.slice(c+7,h);else var l=tipuesearch_string_1;s.pages.push({title:l,text:r,tags:a,url:tipuesearch_pages[n],mainUrl:tipuesearch_pages[n],mainTitle:tipuesearch_pages[n]})});"json"==i.mode&&e.getJSON(i.contentLocation).done(function(t){s=e.extend({},t)}),"static"==i.mode&&(s=e.extend({},tipuesearch));var c="";i.newWindow&&(c=' target="_blank"'),t("q")&&(e("#tipue_search_input").val(t("q")),a(0,!0)),e(this).keyup(function(e){"13"==e.keyCode&&a(0,!0)})})}}(jQuery);
