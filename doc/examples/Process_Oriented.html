
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta charset='utf-8'>
 <title>Process_Oriented.sos</title>
<meta http-equiv="content-type" content="text/html; charset=None">

<style type="text/css">
html {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}

body {
  margin: 0;
}

a {
  background-color: transparent;
  -webkit-text-decoration-skip: objects;
}

a:active,
a:hover {
  outline-width: 0;
}

img {
  border-style: none;
}

pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
  border-style: none;
  padding: 0;
}

button:-moz-focusring,
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring {
  outline: 1px dotted ButtonText;
}

table {
  border-spacing: 0;
  border-collapse: collapse;
}

td {
  padding: 0;
}

* {
  box-sizing: border-box;
}

body {
  font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color: #333;
  background-color: #fff;
}

a {
  color: #4078c0;
  text-decoration: none;
}

a:hover,
a:active {
  text-decoration: underline;
}

pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.container {
  width: 980px;
  margin-right: auto;
  margin-left: auto;
}

.container::before {
  display: table;
  content: "";
}

.container::after {
  display: table;
  clear: both;
  content: "";
}

.right {
  float: right !important;
}

::-moz-placeholder {
  color: #999;
}

:-ms-input-placeholder {
  color: #999;
}

::placeholder {
  color: #999;
}

.form-select::-ms-expand {
  opacity: 0;
}

.avatar {
  display: inline-block;
  overflow: hidden;
  line-height: 1;
  vertical-align: middle;
  border-radius: 3px;
}

.commit-tease {
  position: relative;
  padding: 10px;
  margin-bottom: -1px;
  line-height: 20px;
  color: #68777d;
  background-color: #f2f9fc;
  border: 1px solid #c9e6f2;
  border-radius: 3px;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
}

.commit-tease .message {
  color: inherit;
}

.commit-tease .avatar {
  margin-top: -1px;
}

.commit-tease-sha {
  display: inline-block;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  color: #445055;
}

.full-commit .btn-outline:not(:disabled):hover {
  color: #4078c0;
  border: 1px solid #4078c0;
}

.blob-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
  border-bottom-right-radius: 3px;
  border-bottom-left-radius: 3px;
}

.blob-num {
  width: 1%;
  min-width: 50px;
  padding-right: 10px;
  padding-left: 10px;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
  line-height: 18px;
  color: rgba(0,0,0,0.3);
  text-align: right;
  white-space: nowrap;
  vertical-align: bottom;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  border: solid #eee;
  border-width: 0 1px 0 0;
}

.blob-num:hover {
  color: rgba(0,0,0,0.6);
}

.blob-num::before {
  content: attr(data-line-number);
}

.blob-code {
  position: relative;
  padding-right: 10px;
  padding-left: 10px;
  vertical-align: top;
  white-space: nowrap;
}

.sos-comment {
  /* background: #f7f7f7; */
}
.sos-report {
  background: #FAFAD2;
  padding-top: 5px;
}
.sos-header {
  margin-top: 5px;
  margin-bottom: 0px;
  padding-top: 5px;
  padding-bottom: 5px;
  background-color: #ddd;
  /* border-bottom-color: #dde4e6; */
  color: darkblue;
  border-top-style: solid;

}
.sos-directive {
  padding-top: 5px;
  /* background-color: #fff9ea; */
  border-color: #f1c0c0;
}
.sos-statement {
  padding-top: 5px;
  /* background-color: #f2f9fc; */
}
.sos-error {
  /* background: #ffdddd; */
  color: red;
}
.sos-script {
  position: relative;
  padding-right: 10px;
  padding-left: 30px;
  vertical-align: top;
  /* background-color: #eff0f1; */
}


.blob-code-inner {
  overflow: visible;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
  color: #333;
  word-wrap: normal;
  white-space: pre;
}

.blob-code-inner::before {
  content: "";
}

body {
  min-width: 1020px;
  word-wrap: break-word;
}

.user-mention {
  font-weight: bold;
  color: #333;
  white-space: nowrap;
}

.prose-diff>.markdown-body :not(li.moved).removed {
  color: #a33;
  text-decoration: line-through;
  background: #ffeaea;
}

.prose-diff>.markdown-body :not(.github-user-ins):not(li.moved).removed {
  text-decoration: line-through;
}

.prose-diff>.markdown-body :not(li.moved).added {
  background: #eaffea;
}

.prose-diff>.markdown-body :not(.github-user-del):not(li.moved).added li:not(.moved):not(.github-user-del).added {
  text-decoration: none;
}

:checked+.radio-label {
  position: relative;
  z-index: 1;
  border-color: #4078c0;
}

.select-menu-text-filter input::-moz-placeholder {
  color: #aaa;
}

.select-menu-text-filter input:-ms-input-placeholder {
  color: #aaa;
}

.select-menu-text-filter input::placeholder {
  color: #aaa;
}

.tab-size[data-tab-size="8"] {
  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;
}

# override source
.source {
  background: auto;
}

.file {
  position: relative;
  margin-top: 20px;
  margin-bottom: 15px;
  border: 1px solid #ddd;
  border-radius: 3px;
}

.file-header {
  padding: 5px 10px;
  background-color: #f7f7f7;
  border-bottom: 1px solid #d8d8d8;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}

.file-header::before {
  display: table;
  content: "";
}

.file-header::after {
  display: table;
  clear: both;
  content: "";
}

.file-actions {
  float: right;
  padding-top: 3px;
}

.file-info {
  float: left;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
  line-height: 32px;
}

.file-info-divider {
  display: inline-block;
  width: 1px;
  height: 18px;
  margin-right: 3px;
  margin-left: 3px;
  vertical-align: middle;
  background-color: #ddd;
}

.header-search-input::-ms-clear {
  display: none;
}

.org-validate-group input::-ms-clear {
  display: none;
}


.source .c { color: #8f5902; font-style: italic } /* Comment */
.source .err { color: #a40000; border: 1px solid #ef2929 } /* Error */
.source .g { color: #000000 } /* Generic */
.source .k { color: #204a87; font-weight: bold } /* Keyword */
.source .l { color: #000000 } /* Literal */
.source .n { color: #000000 } /* Name */
.source .o { color: #ce5c00; font-weight: bold } /* Operator */
.source .x { color: #000000 } /* Other */
.source .p { color: #000000; font-weight: bold } /* Punctuation */
.source .ch { color: #8f5902; font-style: italic } /* Comment.Hashbang */
.source .cm { color: #8f5902; font-style: italic } /* Comment.Multiline */
.source .cp { color: #8f5902; font-style: italic } /* Comment.Preproc */
.source .cpf { color: #8f5902; font-style: italic } /* Comment.PreprocFile */
.source .c1 { color: #8f5902; font-style: italic } /* Comment.Single */
.source .cs { color: #8f5902; font-style: italic } /* Comment.Special */
.source .gd { color: #a40000 } /* Generic.Deleted */
.source .ge { color: #000000; font-style: italic } /* Generic.Emph */
.source .gr { color: #ef2929 } /* Generic.Error */
.source .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.source .gi { color: #00A000 } /* Generic.Inserted */
.source .go { color: #000000; font-style: italic } /* Generic.Output */
.source .gp { color: #8f5902 } /* Generic.Prompt */
.source .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.source .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.source .gt { color: #a40000; font-weight: bold } /* Generic.Traceback */
.source .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.source .kd { color: #204a87; font-weight: bold } /* Keyword.Declaration */
.source .kn { color: #204a87; font-weight: bold } /* Keyword.Namespace */
.source .kp { color: #204a87; font-weight: bold } /* Keyword.Pseudo */
.source .kr { color: #204a87; font-weight: bold } /* Keyword.Reserved */
.source .kt { color: #204a87; font-weight: bold } /* Keyword.Type */
.source .ld { color: #000000 } /* Literal.Date */
.source .m { color: #0000cf; font-weight: bold } /* Literal.Number */
.source .s { color: #4e9a06 } /* Literal.String */
.source .na { color: #c4a000 } /* Name.Attribute */
.source .nb { color: #204a87 } /* Name.Builtin */
.source .nc { color: #000000 } /* Name.Class */
.source .no { color: #000000 } /* Name.Constant */
.source .nd { color: #5c35cc; font-weight: bold } /* Name.Decorator */
.source .ni { color: #ce5c00 } /* Name.Entity */
.source .ne { color: #cc0000; font-weight: bold } /* Name.Exception */
.source .nf { color: #000000 } /* Name.Function */
.source .nl { color: #f57900 } /* Name.Label */
.source .nn { color: #000000 } /* Name.Namespace */
.source .nx { color: #000000 } /* Name.Other */
.source .py { color: #000000 } /* Name.Property */
.source .nt { color: #204a87; font-weight: bold } /* Name.Tag */
.source .nv { color: #000000 } /* Name.Variable */
.source .ow { color: #204a87; font-weight: bold } /* Operator.Word */
.source .w { color: #f8f8f8; text-decoration: underline } /* Text.Whitespace */
.source .mb { color: #0000cf; font-weight: bold } /* Literal.Number.Bin */
.source .mf { color: #0000cf; font-weight: bold } /* Literal.Number.Float */
.source .mh { color: #0000cf; font-weight: bold } /* Literal.Number.Hex */
.source .mi { color: #0000cf; font-weight: bold } /* Literal.Number.Integer */
.source .mo { color: #0000cf; font-weight: bold } /* Literal.Number.Oct */
.source .sa { color: #4e9a06 } /* Literal.String.Affix */
.source .sb { color: #4e9a06 } /* Literal.String.Backtick */
.source .sc { color: #4e9a06 } /* Literal.String.Char */
.source .dl { color: #4e9a06 } /* Literal.String.Delimiter */
.source .sd { color: #8f5902; font-style: italic } /* Literal.String.Doc */
.source .s2 { color: #4e9a06 } /* Literal.String.Double */
.source .se { color: #4e9a06 } /* Literal.String.Escape */
.source .sh { color: #4e9a06 } /* Literal.String.Heredoc */
.source .si { color: #4e9a06 } /* Literal.String.Interpol */
.source .sx { color: #4e9a06 } /* Literal.String.Other */
.source .sr { color: #4e9a06 } /* Literal.String.Regex */
.source .s1 { color: #4e9a06 } /* Literal.String.Single */
.source .ss { color: #4e9a06 } /* Literal.String.Symbol */
.source .bp { color: #3465a4 } /* Name.Builtin.Pseudo */
.source .fm { color: #000000 } /* Name.Function.Magic */
.source .vc { color: #000000 } /* Name.Variable.Class */
.source .vg { color: #000000 } /* Name.Variable.Global */
.source .vi { color: #000000 } /* Name.Variable.Instance */
.source .vm { color: #000000 } /* Name.Variable.Magic */
.source .il { color: #0000cf; font-weight: bold } /* Literal.Number.Integer.Long */
 </style>
</head>
<body>



<div class="container new-discussion-timeline experiment-repo-nav">

 <div class="commit-tease">
      <span class="right">
      </span>
 <div>
        <a class="header-logo-invertocat" href="https://vatlab.github.io/SOS" data-hotkey="g d" aria-label="Homepage">
        <img src="http://vatlab.github.io/SOS/img/sos_icon.svg" alt="sos_icon">
        </a>

        <span class="user-mention"><a href="Process_Oriented.sos">Process_Oriented.sos</a></span>
      </div>
      </div>

  <div class="repository-content">
  <div class="file">
  <div class="file-header">

  <div class="file-info">
      <a href="Process_Oriented.sos" class="commit-tease-sha">Process_Oriented.sos</a>
      <span class="file-info-divider"></span>
    4.2 KiB
  </div>
  <div class="file-actions">
  </div>
  </div>
 <div itemprop="text" class="blob-wrapper data type-python">

<table class="highlight tab-size js-file-line-container"><tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="ch">#!/usr/bin/env sos-runner</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>2</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># fileformat=SOS1.0</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>3</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Author: Gao Wang and Bo Peng</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>4</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span> 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>5</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1">#</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>6</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Linear-model based prediction</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>7</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1">#</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>8</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># This script fits linear models</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>9</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># using Lasso and Ridge regression</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>10</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># and summarizes their prediction performance</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>11</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># This script is written in a &quot;forward&quot; flavor</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>12</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span> 
</pre></div>
</td></tr><tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>13
14</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">parameter:</span> <span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>15</pre></div></td><td class="code"><div class="source blob-code sos-header"><pre><span></span><span class="p">[</span><span class="n">lasso_1</span><span class="p">,</span> <span class="n">ridge_1</span><span class="p">:</span> <span class="kp">shared</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data_files&#39;</span><span class="p">:</span> <span class="s1">&#39;step_output&#39;</span><span class="p">}]</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>16</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Simulate sparse data-sets</span>
</pre></div>
</td></tr><tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>17
18
19
20
21
22</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">depends:</span> <span class="n">R_library</span><span class="p">(</span><span class="s2">&quot;MASS&quot;</span><span class="p">)</span>
<span class="kn">parameter:</span> <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="c1"># training and testing samples</span>
<span class="kn">parameter:</span> <span class="n">rstd</span> <span class="o">=</span> <span class="mi">3</span>
<span class="kn">parameter:</span> <span class="n">replicate</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="kn">input:</span> <span class="bp">None</span><span class="p">,</span> <span class="kp">for_each</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;replicate&#39;</span><span class="p">],</span> <span class="kp">concurrent</span> <span class="o">=</span> <span class="bp">True</span>
<span class="kn">output:</span> <span class="n">f</span><span class="s2">&quot;data_{_replicate}.train.csv&quot;</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;data_{_replicate}.test.csv&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>23</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">R:</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;${ }&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="source blob-code sos-script "><pre><span></span><span class="kp">set.seed</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>_<span class="kp">replicate</span><span class="p">})</span>
N <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>paths<span class="p">(</span>N<span class="p">)</span><span class="o">:</span><span class="p">,}))</span>
p <span class="o">=</span> <span class="kp">length</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>paths<span class="p">(</span><span class="kp">beta</span><span class="p">)</span><span class="o">:</span><span class="p">,}))</span>
X <span class="o">=</span> MASS<span class="o">::</span>mvrnorm<span class="p">(</span>n <span class="o">=</span> N<span class="p">,</span> <span class="kp">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> p<span class="p">),</span> <span class="m">0.5</span><span class="o">^</span><span class="kp">abs</span><span class="p">(</span><span class="kp">outer</span><span class="p">(</span><span class="m">1</span><span class="o">:</span>p<span class="p">,</span> <span class="m">1</span><span class="o">:</span>p<span class="p">,</span> FUN <span class="o">=</span> <span class="s">&quot;-&quot;</span><span class="p">)))</span>
Y <span class="o">=</span> X <span class="o">%*%</span> <span class="kt">c</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>paths<span class="p">(</span><span class="kp">beta</span><span class="p">)</span><span class="o">:</span><span class="p">,})</span> <span class="o">+</span> rnorm<span class="p">(</span>N<span class="p">,</span> mean <span class="o">=</span> <span class="m">0</span><span class="p">,</span> sd <span class="o">=</span> <span class="o">$</span><span class="p">{</span>rstd<span class="p">})</span>
Xtrain <span class="o">=</span> X<span class="p">[</span><span class="m">1</span><span class="o">:$</span><span class="p">{</span>N<span class="p">[</span><span class="m">0</span><span class="p">]},];</span> Xtest <span class="o">=</span> X<span class="p">[(</span><span class="o">$</span><span class="p">{</span>N<span class="p">[</span><span class="m">0</span><span class="p">]}</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>N<span class="p">[</span><span class="m">0</span><span class="p">]}</span><span class="o">+$</span><span class="p">{</span>N<span class="p">[</span><span class="m">1</span><span class="p">]}),]</span>
Ytrain <span class="o">=</span> Y<span class="p">[</span><span class="m">1</span><span class="o">:$</span><span class="p">{</span>N<span class="p">[</span><span class="m">0</span><span class="p">]}];</span> Ytest <span class="o">=</span> Y<span class="p">[(</span><span class="o">$</span><span class="p">{</span>N<span class="p">[</span><span class="m">0</span><span class="p">]}</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>N<span class="p">[</span><span class="m">0</span><span class="p">]}</span><span class="o">+$</span><span class="p">{</span>N<span class="p">[</span><span class="m">1</span><span class="p">]})]</span>
write.table<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>Ytrain<span class="p">,</span> Xtrain<span class="p">),</span> <span class="o">$</span><span class="p">{</span>_output<span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> row.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> col.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
write.table<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>Ytest<span class="p">,</span> Xtest<span class="p">),</span> <span class="o">$</span><span class="p">{</span>_output<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> row.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> col.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>34</pre></div></td><td class="code"><div class="source blob-code sos-header"><pre><span></span><span class="p">[</span><span class="n">ridge_2</span><span class="p">]</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>35</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Ridge regression model implemented in R</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>36</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Build predictor via cross-validation and make prediction</span>
</pre></div>
</td></tr><tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>37
38
39
40</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">depends:</span> <span class="n">R_library</span><span class="p">(</span><span class="s2">&quot;glmnet&quot;</span><span class="p">)</span>
<span class="kn">parameter:</span> <span class="n">nfolds</span> <span class="o">=</span> <span class="mi">5</span>
<span class="kn">input:</span> <span class="kp">group_by</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="kp">concurrent</span> <span class="o">=</span> <span class="bp">True</span>
<span class="kn">output:</span> <span class="n">f</span><span class="s2">&quot;{_input[0]:nn}.ridge.predicted.csv&quot;</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;{_input[0]:nn}.ridge.coef.csv&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>41</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">R:</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;${ }&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="source blob-code sos-script "><pre><span></span>train <span class="o">=</span> read.csv<span class="p">(</span><span class="o">$</span><span class="p">{</span>_input<span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> header <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
test <span class="o">=</span> read.csv<span class="p">(</span><span class="o">$</span><span class="p">{</span>_input<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> header <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
model <span class="o">=</span> glmnet<span class="o">::</span>cv.glmnet<span class="p">(</span><span class="kp">as.matrix</span><span class="p">(</span>train<span class="p">[,</span><span class="m">-1</span><span class="p">]),</span> train<span class="p">[,</span><span class="m">1</span><span class="p">],</span> family <span class="o">=</span> <span class="s">&quot;gaussian&quot;</span><span class="p">,</span> alpha <span class="o">=</span> <span class="m">0</span><span class="p">,</span> nfolds <span class="o">=</span> <span class="o">$</span><span class="p">{</span>nfolds<span class="p">},</span> intercept <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
betahat <span class="o">=</span> <span class="kp">as.vector</span><span class="p">(</span>coef<span class="p">(</span>model<span class="p">,</span> s <span class="o">=</span> <span class="s">&quot;lambda.min&quot;</span><span class="p">)[</span><span class="m">-1</span><span class="p">])</span>
Ypred <span class="o">=</span> predict<span class="p">(</span>model<span class="p">,</span> <span class="kp">as.matrix</span><span class="p">(</span>test<span class="p">[,</span><span class="m">-1</span><span class="p">]),</span> s <span class="o">=</span> <span class="s">&quot;lambda.min&quot;</span><span class="p">)</span>
write.table<span class="p">(</span>Ypred<span class="p">,</span> <span class="o">$</span><span class="p">{</span>_output<span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> row.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> col.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
write.table<span class="p">(</span>betahat<span class="p">,</span> <span class="o">$</span><span class="p">{</span>_output<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> row.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> col.names <span class="o">=</span> <span class="bp">F</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>50</pre></div></td><td class="code"><div class="source blob-code sos-header"><pre><span></span><span class="p">[</span><span class="n">lasso_2</span><span class="p">]</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>51</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># LASSO model implemented in Python</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>52</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Build predictor via cross-validation and make prediction</span>
</pre></div>
</td></tr><tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>53
54
55
56</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">depends:</span> <span class="n">Py_Module</span><span class="p">(</span><span class="s2">&quot;sklearn&quot;</span><span class="p">)</span>
<span class="kn">parameter:</span> <span class="n">nfolds</span> <span class="o">=</span> <span class="mi">5</span>
<span class="kn">input:</span> <span class="kp">group_by</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="kp">concurrent</span> <span class="o">=</span> <span class="bp">True</span>
<span class="kn">output:</span> <span class="n">f</span><span class="s2">&quot;{_input[0]:nn}.lasso.predicted.csv&quot;</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;{_input[0]:nn}.lasso.coef.csv&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>57</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">python:</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;${ }&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="source blob-code sos-script "><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="err">$</span><span class="p">{</span><span class="n">_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r</span><span class="p">},</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="err">$</span><span class="p">{</span><span class="n">_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r</span><span class="p">},</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span> <span class="o">=</span> <span class="err">$</span><span class="p">{</span><span class="n">nfolds</span><span class="p">},</span> <span class="n">fit_intercept</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:],</span> <span class="n">train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="err">$</span><span class="p">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">r</span><span class="p">},</span> <span class="n">Ypred</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="err">$</span><span class="p">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">r</span><span class="p">},</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>67</pre></div></td><td class="code"><div class="source blob-code sos-header"><pre><span></span><span class="p">[</span><span class="n">lasso_3</span><span class="p">,</span> <span class="n">ridge_3</span><span class="p">]</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>68</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># Evaluate predictors by calculating mean squared error</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>69</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># of prediction vs truth (first line of output)</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>70</pre></div></td><td class="code"><div class="source blob-code sos-comment"><pre><span></span><span class="c1"># and of betahat vs truth (2nd line of output)</span>
</pre></div>
</td></tr><tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>71
72
73
74</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">depends:</span> <span class="n">sos_variable</span><span class="p">(</span><span class="s1">&#39;data_files&#39;</span><span class="p">)</span>
<span class="kn">parameter:</span> <span class="n">replicates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">data_files</span><span class="p">),)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
<span class="kn">input:</span> <span class="kp">group_by</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="kp">group_with</span> <span class="o">=</span> <span class="s1">&#39;replicates&#39;</span><span class="p">,</span> <span class="kp">concurrent</span> <span class="o">=</span> <span class="bp">True</span>
<span class="kn">output:</span> <span class="n">f</span><span class="s2">&quot;{_input[0]:nn}.mse.csv&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>75</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">R:</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;${ }&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="source blob-code sos-script "><pre><span></span>b <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>paths<span class="p">(</span><span class="kp">beta</span><span class="p">)</span><span class="o">:</span><span class="p">,})</span>
Ytruth <span class="o">=</span> <span class="kp">as.matrix</span><span class="p">(</span>read.csv<span class="p">(</span><span class="o">$</span><span class="p">{</span>_replicates<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>r<span class="p">},</span> header <span class="o">=</span> <span class="bp">F</span><span class="p">)[,</span><span class="m">-1</span><span class="p">])</span> <span class="o">%*%</span> b
Ypred <span class="o">=</span> <span class="kp">scan</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>_input<span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">:</span>r<span class="p">})</span>
prediction_mse <span class="o">=</span> <span class="kp">mean</span><span class="p">((</span>Ytruth <span class="o">-</span> Ypred<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
betahat <span class="o">=</span> <span class="kp">scan</span><span class="p">(</span><span class="o">$</span><span class="p">{</span>_input<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>r<span class="p">})</span>
estimation_mse <span class="o">=</span> <span class="kp">mean</span><span class="p">((</span>betahat <span class="o">-</span> b<span class="p">)</span> <span class="o">^</span> <span class="m">2</span><span class="p">)</span>
<span class="kp">cat</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span>prediction_mse<span class="p">,</span> estimation_mse<span class="p">),</span> file <span class="o">=</span> <span class="o">$</span><span class="p">{</span>_output<span class="o">:</span>r<span class="p">})</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>84</pre></div></td><td class="code"><div class="source blob-code sos-header"><pre><span></span><span class="p">[</span><span class="n">default_1</span><span class="p">]</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>85
86
87</pre></div></td><td class="code"><div class="source blob-code sos-statement"><pre><span></span><span class="n">sos_run</span><span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">)</span>
<span class="n">sos_run</span><span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">)</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>88</pre></div></td><td class="code"><div class="source blob-code sos-header"><pre><span></span><span class="p">[</span><span class="n">default_2</span><span class="p">]</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>89
90</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">depends:</span> <span class="n">executable</span><span class="p">(</span><span class="s2">&quot;pandoc&quot;</span><span class="p">)</span>
<span class="kn">input:</span> <span class="n">dynamic</span><span class="p">(</span><span class="s2">&quot;*.mse.csv&quot;</span><span class="p">)</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>91
92
93
94</pre></div></td><td class="code"><div class="source blob-code sos-statement"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">ridge_summary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()],</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">_input</span> <span class="k">if</span> <span class="s1">&#39;ridge&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">lasso_summary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()],</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">_input</span> <span class="k">if</span> <span class="s1">&#39;lasso&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>95</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">report:</span> <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;report.md&quot;</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;${ }&quot;</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre> 96
 97
 98
 99
100
101</pre></div></td><td class="code"><div class="source blob-code sos-report"><pre><span></span> 
| Method | Avg. Estimation Error | Avg. Prediction Error |
|:------:|:-------:|:-------:|
| LASSO | ${lasso_summary[1]} | ${lasso_summary[0]} |
| Ridge | ${ridge_summary[1]} | ${ridge_summary[0]} |
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>102</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">download:</span>
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>103
104</pre></div></td><td class="code"><div class="source blob-code sos-script "><pre><span></span>https://vatlab.github.io/sos-docs/css/pandoc.css
 
</pre></div>
</td></tr>
<tr><td class="blob-num js-line-number"><div class="linenodiv"><pre>105</pre></div></td><td class="code"><div class="source blob-code sos-directive"><pre><span></span><span class="kn">pandoc:</span> <span class="nb">input</span> <span class="o">=</span> <span class="s2">&quot;report.md&quot;</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;report.html&quot;</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="s1">&#39;{input:q} --css pandoc.css --output {output:q}&#39;</span>
</pre></div>
</td></tr>
</table>
</div>
</div>
</div>
</body></html>
